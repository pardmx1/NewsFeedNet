@model FeedViewModel
@{
    ViewData["Title"] = "News Feed";
}

<div class="container">
    @Html.HiddenFor(m => m.refreshTime, new { @id = "refreshTime"})
    <div class="row justify-content-center">
        
        <h3>Borwse News by Date</h3>
        <div class="col">
            <div class="input-group">
                @Html.TextBoxFor(m => m.startDate, "{0:yyyy-MM-dd}", new { placeholder="Select Date", @id = "startDate", @class = "form-control" })
                <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">Start Date</span>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="input-group">
                @Html.TextBoxFor(m => m.endDate, "{0:yyyy-MM-dd}", new { placeholder = "Select Date", @id = "endDate", @class = "form-control" })
                <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">End Date</span>
                </div>
            </div>
        </div>
        <div class="col">
            <button id="btnApply" type="button" class="btn btn-primary">Apply</button>
        </div>
    </div>
    <div class="row">
        <div id="articles"></div>
    </div>
</div>

@section scripts
{
    <script type="text/javascript">        
        $(document).ready(function () {
            var refreshTime = $('#refreshTime').val();
            $('#startDate').datepicker({
                dateFormat: 'yy-mm-dd'
            });
            $('#endDate').datepicker({
                dateFormat: 'yy-mm-dd'
            });
            $('#btnApply').click(function () {
                GetArticles();
            });
            GetArticles();
            setInterval(UpdateFeeed,refreshTime * 1000);

        });

        function UpdateFeeed() {
            console.log('feed updated');
            GetArticles();
        }

        function GetArticles() {
            var startDate = $('#startDate').val();
            var endDate = $('#endDate').val();
            var url = '/Home/PartialFeed'
            $.ajax({
                type: 'POST',
                url: url,
                cache: false,
                async: true,
                dataType: 'html',
                data: { startDate: startDate, endDate: endDate },
                success: function (result) {
                    $('#articles').html(result);
                },
                error: function (xhr) {
                    console.log('error : ' + xhr.status + ' - ' + xhr.statusText + ' - ' + xhr.responseText);
                }
            });
        }

    </script>
}

